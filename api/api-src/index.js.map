{"version":3,"sources":["../../api-src/index.ts"],"sourcesContent":["import { StreamableHTTPServerTransport } from '@modelcontextprotocol/sdk/server/streamableHttp.js'\nimport express from 'express'\nimport 'source-map-support/register'\nimport logger from '../src/logger'\nimport { createMcpServer } from '../src/mcp'\n\nimport '../src/oss'\nimport '../src/tool-definations'\n\nconst app = express()\nconst port = process.env.PORT || 18900\n\napp.use(express.json())\n\napp.use((req, res, next) => {\n  const start = Date.now()\n  res.on('finish', () => {\n    const duration = Date.now() - start\n    logger.info('access-log', {\n      method: req.method,\n      url: req.originalUrl,\n      query: req.query,\n      body: req.body,\n      ip: req.ip,\n      status: res.statusCode,\n      duration: `${duration}ms`,\n    })\n  })\n  next()\n})\n\napp.post('/mcp', async (req, res) => {\n  // In stateless mode, create a new instance of transport and server for each request\n  // to ensure complete isolation. A single instance would cause request ID collisions\n  // when multiple clients connect concurrently.\n\n  try {\n    const server = createMcpServer()\n    const transport: StreamableHTTPServerTransport = new StreamableHTTPServerTransport({\n      sessionIdGenerator: undefined,\n    })\n    res.on('close', () => {\n      console.log('Request closed')\n      transport.close()\n      server.close()\n    })\n    await server.connect(transport)\n    await transport.handleRequest(req, res, req.body)\n  } catch (error) {\n    console.error('Error handling MCP request:', error)\n    if (!res.headersSent) {\n      res.status(500).json({\n        jsonrpc: '2.0',\n        error: {\n          code: -32603,\n          message: 'Internal server error',\n        },\n        id: null,\n      })\n    }\n  }\n})\n\napp.get('/mcp', async (_req, res) => {\n  console.log('Received GET MCP request')\n  res.writeHead(405).end(\n    JSON.stringify({\n      jsonrpc: '2.0',\n      error: {\n        code: -32000,\n        message: 'Method not allowed.',\n      },\n      id: null,\n    }),\n  )\n})\n\napp.delete('/mcp', async (_req, res) => {\n  console.log('Received DELETE MCP request')\n  res.writeHead(405).end(\n    JSON.stringify({\n      jsonrpc: '2.0',\n      error: {\n        code: -32000,\n        message: 'Method not allowed.',\n      },\n      id: null,\n    }),\n  )\n})\n\napp.listen(port, () => {\n  logger.info(`Server listening at http://localhost:${port}`)\n})\n\nexport default app\n"],"names":["app","express","port","process","env","PORT","use","json","req","res","next","start","Date","now","on","duration","logger","info","method","url","originalUrl","query","body","ip","status","statusCode","post","server","createMcpServer","transport","StreamableHTTPServerTransport","sessionIdGenerator","undefined","console","log","close","connect","handleRequest","error","headersSent","jsonrpc","code","message","id","get","_req","writeHead","end","JSON","stringify","delete","listen"],"mappings":";;;;+BA+FA;;;eAAA;;;gCA/F8C;gEAC1B;QACb;+DACY;qBACa;QAEzB;QACA;;;;;;AAEP,MAAMA,MAAMC,IAAAA,gBAAO;AACnB,MAAMC,OAAOC,QAAQC,GAAG,CAACC,IAAI,IAAI;AAEjCL,IAAIM,GAAG,CAACL,gBAAO,CAACM,IAAI;AAEpBP,IAAIM,GAAG,CAAC,CAACE,KAAKC,KAAKC;IACjB,MAAMC,QAAQC,KAAKC,GAAG;IACtBJ,IAAIK,EAAE,CAAC,UAAU;QACf,MAAMC,WAAWH,KAAKC,GAAG,KAAKF;QAC9BK,eAAM,CAACC,IAAI,CAAC,cAAc;YACxBC,QAAQV,IAAIU,MAAM;YAClBC,KAAKX,IAAIY,WAAW;YACpBC,OAAOb,IAAIa,KAAK;YAChBC,MAAMd,IAAIc,IAAI;YACdC,IAAIf,IAAIe,EAAE;YACVC,QAAQf,IAAIgB,UAAU;YACtBV,UAAU,GAAGA,SAAS,EAAE,CAAC;QAC3B;IACF;IACAL;AACF;AAEAV,IAAI0B,IAAI,CAAC,QAAQ,OAAOlB,KAAKC;IAC3B,oFAAoF;IACpF,oFAAoF;IACpF,8CAA8C;IAE9C,IAAI;QACF,MAAMkB,SAASC,IAAAA,oBAAe;QAC9B,MAAMC,YAA2C,IAAIC,6CAA6B,CAAC;YACjFC,oBAAoBC;QACtB;QACAvB,IAAIK,EAAE,CAAC,SAAS;YACdmB,QAAQC,GAAG,CAAC;YACZL,UAAUM,KAAK;YACfR,OAAOQ,KAAK;QACd;QACA,MAAMR,OAAOS,OAAO,CAACP;QACrB,MAAMA,UAAUQ,aAAa,CAAC7B,KAAKC,KAAKD,IAAIc,IAAI;IAClD,EAAE,OAAOgB,OAAO;QACdL,QAAQK,KAAK,CAAC,+BAA+BA;QAC7C,IAAI,CAAC7B,IAAI8B,WAAW,EAAE;YACpB9B,IAAIe,MAAM,CAAC,KAAKjB,IAAI,CAAC;gBACnBiC,SAAS;gBACTF,OAAO;oBACLG,MAAM,CAAC;oBACPC,SAAS;gBACX;gBACAC,IAAI;YACN;QACF;IACF;AACF;AAEA3C,IAAI4C,GAAG,CAAC,QAAQ,OAAOC,MAAMpC;IAC3BwB,QAAQC,GAAG,CAAC;IACZzB,IAAIqC,SAAS,CAAC,KAAKC,GAAG,CACpBC,KAAKC,SAAS,CAAC;QACbT,SAAS;QACTF,OAAO;YACLG,MAAM,CAAC;YACPC,SAAS;QACX;QACAC,IAAI;IACN;AAEJ;AAEA3C,IAAIkD,MAAM,CAAC,QAAQ,OAAOL,MAAMpC;IAC9BwB,QAAQC,GAAG,CAAC;IACZzB,IAAIqC,SAAS,CAAC,KAAKC,GAAG,CACpBC,KAAKC,SAAS,CAAC;QACbT,SAAS;QACTF,OAAO;YACLG,MAAM,CAAC;YACPC,SAAS;QACX;QACAC,IAAI;IACN;AAEJ;AAEA3C,IAAImD,MAAM,CAACjD,MAAM;IACfc,eAAM,CAACC,IAAI,CAAC,CAAC,qCAAqC,EAAEf,MAAM;AAC5D;MAEA,WAAeF"}